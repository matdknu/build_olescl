library(quarto)
# Función para renderizar todos los QMD en una carpeta
render_folder <- function(folder, output_format = "html") {
qmd_files <- list.files(
path = folder,
pattern = "\\.qmd$",
full.names = TRUE,
recursive = TRUE
)
for (qmd_file in qmd_files) {
cat("Renderizando:", qmd_file, "\n")
tryCatch({
quarto_render(qmd_file, output_format = output_format)
cat("✓ Completado:", qmd_file, "\n")
}, error = function(e) {
cat("✗ Error en:", qmd_file, "\n")
cat("  ", e$message, "\n")
})
}
}
# Renderizar todas las carpetas (excepto equipo, que usa script personalizado)
cat("=== Renderizando Noticias ===\n")
render_folder("content/noticias")
#!/usr/bin/env Rscript
# Script para ejecutar quarto preview en la red local desde R
library(quarto)
# Explicación del comando:
# quarto preview --render all --no-watch-inputs --no-browse
#
# --render all: Renderiza todos los archivos QMD antes de iniciar el preview
# --no-watch-inputs: NO observa cambios en archivos (no recarga automáticamente)
# --no-browse: NO abre el navegador automáticamente
cat("=== Iniciando Quarto Preview ===\n")
cat("El servidor estará disponible en:\n")
cat("  - http://localhost:4200\n")
cat("  - http://127.0.0.1:4200\n")
cat("\n")
cat("Para acceder desde otros dispositivos en la red local,\n")
cat("usa la IP de esta computadora con el puerto 4200\n")
cat("(ej: http://192.168.1.14:4200)\n")
cat("\n")
cat("Presiona Ctrl+C para detener el servidor\n\n")
# Ejecutar quarto preview
# Nota: quarto_preview() de la librería quarto no tiene todas las opciones
# Por eso usamos system() para ejecutar el comando completo
system("quarto preview --render all --no-watch-inputs --no-browse")
# Script para desplegar la aplicación Shiny en shinyapps.io
# Soluciona problemas de SSL/TLS
# Cargar librería
library(rsconnect)
# Configurar opciones SSL para evitar errores de certificado
# Solución para error "cert already in hash table" en macOS
options(rsconnect.check.certificate = FALSE)
# Configurar curl para macOS
if (Sys.info()["sysname"] == "Darwin") {
# macOS - usar certificados del sistema
Sys.setenv(CURL_CA_BUNDLE = "")
options(RCurlOptions = list(
ssl.verifypeer = TRUE,
ssl.verifyhost = TRUE,
verbose = FALSE,
cainfo = system.file("CurlSSL", "cacert.pem", package = "RCurl")
))
} else {
options(RCurlOptions = list(
ssl.verifypeer = TRUE,
ssl.verifyhost = TRUE,
verbose = FALSE
))
}
# Configurar timeout más largo
options(timeout = 300)
cat("=== Configuración de Despliegue ===\n")
cat("Opciones SSL configuradas\n")
cat("Timeout: 300 segundos\n\n")
# Verificar cuenta
cat("Verificando cuenta de shinyapps.io...\n")
accounts <- rsconnect::accounts()
print(accounts)
if (nrow(accounts) == 0) {
cat("\n⚠️  No hay cuentas configuradas.\n")
cat("Por favor, configura tu cuenta primero:\n")
cat("rsconnect::setAccountInfo(\n")
cat("  name = 'tu-nombre-usuario',\n")
cat("  token = 'TU_TOKEN',\n")
cat("  secret = 'TU_SECRET'\n")
cat(")\n")
stop("Cuenta no configurada")
}
# Nombre de la aplicación
app_name <- "analisis-prensa-carabineros"
cat("\n=== Desplegando aplicación ===\n")
cat("Nombre de la app:", app_name, "\n")
cat("Directorio:", getwd(), "\n\n")
# Intentar desplegar
tryCatch({
rsconnect::deployApp(
appDir = ".",
appName = app_name,
account = accounts$name[1],
forceUpdate = TRUE,
launch.browser = FALSE
)
cat("\n✅ ¡Despliegue exitoso!\n")
cat("La aplicación está disponible en:\n")
cat(paste0("https://", accounts$name[1], ".shinyapps.io/", app_name, "/\n"))
}, error = function(e) {
cat("\n❌ Error durante el despliegue:\n")
cat(conditionMessage(e), "\n\n")
cat("=== Soluciones alternativas ===\n")
cat("1. Actualiza rsconnect: install.packages('rsconnect')\n")
cat("2. Actualiza curl: brew upgrade curl (en macOS)\n")
cat("3. Intenta desde RStudio usando el botón 'Publish'\n")
cat("4. Revisa SOLUCION-SSL.md para más opciones\n")
stop(conditionMessage(e))
})
source("~/Dropbox/OLES/2020_legitimidad_carabineros/build_olescl/shiny-app/deploy-correcto.R", echo=TRUE)
